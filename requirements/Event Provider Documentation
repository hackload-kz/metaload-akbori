<div class="prose prose-invert prose-slate max-w-none prose-headings:text-white prose-h1:text-3xl prose-h1:font-bold prose-h1:mb-6 prose-h1:border-b prose-h1:border-slate-700 prose-h1:pb-4 prose-h2:text-2xl prose-h2:font-semibold prose-h2:mb-4 prose-h2:mt-8 prose-h3:text-xl prose-h3:font-semibold prose-h3:mb-3 prose-h3:mt-6 prose-h4:text-lg prose-h4:font-semibold prose-h4:mb-2 prose-h4:mt-4 prose-p:text-slate-300 prose-p:mb-4 prose-p:leading-relaxed prose-ul:text-slate-300 prose-ul:mb-4 prose-ul:list-disc prose-ul:list-inside prose-ul:space-y-2 prose-ol:text-slate-300 prose-ol:mb-4 prose-ol:list-decimal prose-ol:list-inside prose-ol:space-y-2 prose-li:text-slate-300 prose-code:bg-slate-700/50 prose-code:text-amber-400 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:font-mono prose-pre:bg-slate-800 prose-pre:border prose-pre:border-slate-700 prose-pre:rounded-lg prose-pre:p-4 prose-pre:mb-4 prose-pre:overflow-x-auto prose-pre:text-slate-300 prose-blockquote:border-l-4 prose-blockquote:border-amber-400 prose-blockquote:pl-4 prose-blockquote:py-2  prose-blockquote:mb-4 prose-blockquote:bg-slate-800/30 prose-blockquote:italic prose-blockquote:text-slate-300 prose-table:border prose-table:border-slate-700 prose-table:rounded-lg prose-table:mb-4 prose-thead:bg-slate-800 prose-tbody:bg-slate-900/50 prose-tr:border-b prose-tr:border-slate-700 prose-th:px-4 prose-th:py-3 prose-th:text-left prose-th:text-white prose-th:font-semibold prose-td:px-4 prose-td:py-3 prose-td:text-slate-300 prose-a:text-amber-400 prose-a:underline hover:prose-a:text-amber-300 prose-strong:text-white prose-strong:font-semibold prose-em:text-slate-300 prose-em:italic"><h1>Hackload Ticketing Service Provider</h1>
<p><em>Последнее обновление: 14 августа 2025 г. в 17:20</em></p>
<h2>Обзор</h2>
<p>Hackload Ticketing Service Provider — это REST API сервис для управления заказами билетов и бронированием мест. Сервис предоставляет две основные роли пользователей:</p>
<ul>
<li><strong>Администратор</strong>: Может создавать и управлять местами/сиденьями в заведении</li>
<li><strong>Партнеры</strong>: Могут создавать заказы, выбирать места и управлять бронированием</li>
</ul>
<h2>Эндпоинты API</h2>
<h3>Эндпоинты партнеров</h3>
<h4>1. Начать заказ</h4>
<p>Создает новый заказ и возвращает ID заказа.</p>
<p><strong>Эндпоинт:</strong> <code>POST /api/partners/v1/orders</code></p>
<p><strong>Ответ (201 Created):</strong></p>
<pre><code class="language-json">{
  "order_id": "98c123b9-fc80-4d6b-a3f6-0cbe84e0fd88"
}
</code></pre>
<p><strong>Пример:</strong></p>
<pre><code class="language-bash">curl -X POST "http://localhost:8080/api/partners/v1/orders"
</code></pre>
<h4>2. Получить заказ</h4>
<p>Получает детали заказа по ID.</p>
<p><strong>Эндпоинт:</strong> <code>GET /api/partners/v1/orders/{id}</code></p>
<p><strong>Ответ (200 OK):</strong></p>
<pre><code class="language-json">{
  "id": "98c123b9-fc80-4d6b-a3f6-0cbe84e0fd88",
  "status": "STARTED",
  "started_at": 1753513916968,
  "updated_at": 1753513966871,
  "places_count": 1
}
</code></pre>
<p><strong>Пример:</strong></p>
<pre><code class="language-bash">curl -X GET "http://localhost:8080/api/partners/v1/orders/98c123b9-fc80-4d6b-a3f6-0cbe84e0fd88"
</code></pre>
<h4>3. Отправить заказ</h4>
<p>Отправляет заказ на обработку. После отправки можно только подтвердить или отменить заказ.</p>
<p><strong>Эндпоинт:</strong> <code>PATCH /api/partners/v1/orders/{id}/submit</code></p>
<p><strong>Ответ:</strong> <code>200 OK</code> (без тела)</p>
<p><strong>Пример:</strong></p>
<pre><code class="language-bash">curl -X PATCH "http://localhost:8080/api/partners/v1/orders/98c123b9-fc80-4d6b-a3f6-0cbe84e0fd88/submit"
</code></pre>
<h4>4. Подтвердить заказ</h4>
<p>Подтверждает заказ (терминальный статус - дальнейшие изменения невозможны).</p>
<p><strong>Эндпоинт:</strong> <code>PATCH /api/partners/v1/orders/{id}/confirm</code></p>
<p><strong>Ответ:</strong> <code>200 OK</code> (без тела)</p>
<p><strong>Пример:</strong></p>
<pre><code class="language-bash">curl -X PATCH "http://localhost:8080/api/partners/v1/orders/98c123b9-fc80-4d6b-a3f6-0cbe84e0fd88/confirm"
</code></pre>
<h4>5. Отменить заказ</h4>
<p>Отменяет заказ. Подтвержденные заказы не могут быть отменены.</p>
<p><strong>Эндпоинт:</strong> <code>PATCH /api/partners/v1/orders/{id}/cancel</code></p>
<p><strong>Ответ:</strong> <code>200 OK</code> (без тела)</p>
<p><strong>Пример:</strong></p>
<pre><code class="language-bash">curl -X PATCH "http://localhost:8080/api/partners/v1/orders/98c123b9-fc80-4d6b-a3f6-0cbe84e0fd88/cancel"
</code></pre>
<h4>6. Список мест</h4>
<p>Получает доступные места с пагинацией.</p>
<p><strong>Эндпоинт:</strong> <code>GET /api/partners/v1/places?page={page}&amp;pageSize={pageSize}</code></p>
<p><strong>Параметры запроса:</strong></p>
<ul>
<li><code>page</code> (необязательно): Номер страницы (по умолчанию: 1, минимум: 1)</li>
<li><code>pageSize</code> (необязательно): Элементов на странице (по умолчанию: 20, максимум: 1000)</li>
</ul>
<p><strong>Ответ (200 OK):</strong></p>
<pre><code class="language-json">[
  {
    "id": "1bf2726c-b6b7-459f-be3f-8124ecd7c619",
    "row": 1,
    "seat": 1,
    "is_free": true
  }
]
</code></pre>
<p><strong>Пример:</strong></p>
<pre><code class="language-bash">curl -X GET "http://localhost:8080/api/partners/v1/places?page=1&amp;pageSize=20"
</code></pre>
<h4>7. Получить отдельное место</h4>
<p>Получает детали конкретного места.</p>
<p><strong>Эндпоинт:</strong> <code>GET /api/partners/v1/places/{id}</code></p>
<p><strong>Ответ (200 OK):</strong></p>
<pre><code class="language-json">{
  "id": "1bf2726c-b6b7-459f-be3f-8124ecd7c619",
  "row": 1,
  "seat": 1,
  "is_free": true
}
</code></pre>
<p><strong>Пример:</strong></p>
<pre><code class="language-bash">curl -X GET "http://localhost:8080/api/partners/v1/places/1bf2726c-b6b7-459f-be3f-8124ecd7c619"
</code></pre>
<h4>8. Выбрать место</h4>
<p>Выбирает/резервирует место для заказа.</p>
<p><strong>Эндпоинт:</strong> <code>PATCH /api/partners/v1/places/{id}/select</code></p>
<p><strong>Тело запроса:</strong></p>
<pre><code class="language-json">{
  "order_id": "98c123b9-fc80-4d6b-a3f6-0cbe84e0fd88"
}
</code></pre>
<p><strong>Ответ:</strong> <code>204 No Content</code> (без тела)</p>
<p><strong>Пример:</strong></p>
<pre><code class="language-bash">curl -X PATCH "http://localhost:8080/api/partners/v1/places/1bf2726c-b6b7-459f-be3f-8124ecd7c619/select" \
  -H "Content-Type: application/json" \
  -d '{
    "order_id": "98c123b9-fc80-4d6b-a3f6-0cbe84e0fd88"
  }'
</code></pre>
<h4>9. Освободить место</h4>
<p>Освобождает выбранное место (работает только с начатыми заказами).</p>
<p><strong>Эндпоинт:</strong> <code>PATCH /api/partners/v1/places/{id}/release</code></p>
<p><strong>Ответ:</strong> <code>204 No Content</code> (без тела)</p>
<p><strong>Пример:</strong></p>
<pre><code class="language-bash">curl -X PATCH "http://localhost:8080/api/partners/v1/places/1bf2726c-b6b7-459f-be3f-8124ecd7c619/release"
</code></pre>
<h2>Сценарии использования сервиса</h2>
<h3>Типичный рабочий процесс заказа</h3>
<ol>
<li><p><strong>Начать новый заказ</strong></p>
<ul>
<li>Вызвать <code>POST /api/partners/v1/orders</code></li>
<li>Получить ID заказа для последующих операций</li>
</ul>
</li>
<li><p><strong>Просмотреть доступные места</strong></p>
<ul>
<li>Вызвать <code>GET /api/partners/v1/places</code> для просмотра доступных мест</li>
<li>Фильтровать по <code>is_free: true</code> для поиска свободных мест</li>
</ul>
</li>
<li><p><strong>Выбрать места для заказа</strong></p>
<ul>
<li>Вызвать <code>PATCH /api/partners/v1/places/{id}/select</code> для каждого желаемого места</li>
<li>Место становится <code>is_free: false</code> и резервируется для вашего заказа</li>
</ul>
</li>
<li><p><strong>Просмотреть заказ</strong></p>
<ul>
<li>Вызвать <code>GET /api/partners/v1/orders/{id}</code> для проверки деталей заказа</li>
<li>Убедиться, что <code>places_count</code> соответствует выбранным местам</li>
</ul>
</li>
<li><p><strong>Отправить заказ</strong></p>
<ul>
<li>Вызвать <code>PATCH /api/partners/v1/orders/{id}/submit</code></li>
<li>Статус заказа изменится на <code>SUBMITTED</code></li>
<li>Больше нельзя добавлять/удалять места</li>
</ul>
</li>
<li><p><strong>Финальное действие</strong></p>
<ul>
<li><strong>Подтвердить:</strong> Вызвать <code>PATCH /api/partners/v1/orders/{id}/confirm</code> (терминальный)</li>
<li><strong>Отменить:</strong> Вызвать <code>PATCH /api/partners/v1/orders/{id}/cancel</code></li>
</ul>
</li>
</ol>
<h3>Состояния заказа и переходы</h3>
<pre><code>STARTED → SUBMITTED → CONFIRMED (терминальный)
   ↓         ↓
CANCELLED ← CANCELLED
</code></pre>
<ul>
<li><strong>STARTED</strong>: Можно добавлять/удалять места, отправлять или отменять</li>
<li><strong>SUBMITTED</strong>: Можно только подтвердить или отменить</li>
<li><strong>CONFIRMED</strong>: Терминальное состояние (изменения невозможны)</li>
<li><strong>CANCELLED</strong>: Терминальное состояние (изменения невозможны)</li>
</ul>
<h3>Административная настройка</h3>
<ol>
<li><strong>Создать планировку заведения</strong><ul>
<li>Использовать <code>POST /api/admin/v1/places</code> для создания мест</li>
<li>Настроить ряды и номера мест согласно планировке заведения</li>
</ul>
</li>
</ol>
<h2>Обработка ошибок</h2>
<h3>Коды состояния HTTP</h3>
<ul>
<li><strong>200 OK</strong>: Запрос успешно выполнен</li>
<li><strong>201 Created</strong>: Ресурс успешно создан</li>
<li><strong>204 No Content</strong>: Запрос выполнен успешно без тела ответа</li>
<li><strong>404 Not Found</strong>: Ресурс не найден</li>
<li><strong>409 Conflict</strong>: Нарушение бизнес-правил</li>
<li><strong>422 Unprocessable Entity</strong>: Неверный формат запроса</li>
<li><strong>403 Forbidden</strong>: Операция не разрешена</li>
<li><strong>500 Internal Server Error</strong>: Ошибка сервера</li>
</ul>
<h3>Ошибки бизнес-логики (409 Conflict)</h3>
<h4>Ошибки, связанные с заказами</h4>
<ul>
<li><strong>OrderNotStartedException</strong>: Попытка операций с не начатым заказом</li>
<li><strong>OrderNotSubmittedException</strong>: Попытка подтвердить заказ, который не был отправлен</li>
<li><strong>OrderAlreadyCancelledException</strong>: Попытка операций с отмененным заказом</li>
<li><strong>ConfirmedOrderCanNotBeCancelledException</strong>: Попытка отменить подтвержденный заказ</li>
<li><strong>NoPlacesAddedException</strong>: Попытка отправить заказ без мест</li>
</ul>
<h4>Ошибки, связанные с местами (409 Conflict)</h4>
<ul>
<li><strong>PlaceAlreadySelectedException</strong>: Попытка выбрать уже зарезервированное место</li>
<li><strong>PlaceCanNotBeAddedToOrderException</strong>: Место не может быть добавлено к указанному заказу</li>
</ul>
<h4>Ошибки, связанные с местами (403 Forbidden)</h4>
<ul>
<li><strong>PlaceSelectedForAnotherOrderException</strong>: Попытка освободить место, выбранное для другого заказа</li>
</ul>
<h4>Другие ошибки</h4>
<ul>
<li><strong>PlaceNotAddedException</strong>: Попытка удалить место, которое не было добавлено к заказу</li>
</ul>
<h3>Формат ответа об ошибке</h3>
<p>Ошибки возвращают соответствующие коды состояния HTTP. Для нарушений бизнес-логики проверьте ожидаемые коды состояния в конкретных эндпоинтах выше.</p>
<h2>Лучшие практики</h2>
<h3>Для партнеров</h3>
<ol>
<li><p><strong>Управление заказами</strong></p>
<ul>
<li>Всегда начинайте с создания заказа</li>
<li>Проверяйте статус заказа перед выполнением операций</li>
<li>Отправляйте заказы только когда все желаемые места выбраны</li>
</ul>
</li>
<li><p><strong>Выбор мест</strong></p>
<ul>
<li>Проверяйте статус <code>is_free</code> перед попыткой выбора</li>
<li>Корректно обрабатывайте конфликты когда места уже заняты</li>
<li>Своевременно освобождайте места если заказ отменен</li>
</ul>
</li>
<li><p><strong>Обработка ошибок</strong></p>
<ul>
<li>Реализуйте логику повторных попыток для ответов 409 Conflict</li>
<li>Обрабатывайте ответы 404 для несуществующих ресурсов</li>
<li>Ведите логи и мониторинг ошибок 500 для системных проблем</li>
</ul>
</li>
</ol>
</div>