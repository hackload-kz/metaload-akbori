# Biletter Service

–°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è–º–∏, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏ –∏ –º–µ—Å—Ç–∞–º–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (PostgreSQL + Kafka + –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
./start.sh

# –ò–ª–∏ –ø–æ—à–∞–≥–æ–≤–æ:
docker-compose up -d
mvn spring-boot:run
```

## üìã –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### Events (–°–æ–±—ã—Ç–∏—è)
- `POST /api/events` - –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
- `GET /api/events` - –°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π

### Bookings (–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
- `POST /api/bookings` - –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `GET /api/bookings` - –°–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- `PATCH /api/bookings/initiatePayment` - –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞
- `PATCH /api/bookings/cancel` - –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### Seats (–ú–µ—Å—Ç–∞)
- `GET /api/seats` - –°–ø–∏—Å–æ–∫ –º–µ—Å—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- `PATCH /api/seats/select` - –í—ã–±–æ—Ä –º–µ—Å—Ç–∞
- `PATCH /api/seats/release` - –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç–∞

### Payments (–ü–ª–∞—Ç–µ–∂–∏)
- `GET /api/payments/success` - –£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂
- `GET /api/payments/fail` - –ù–µ—É–¥–∞—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂
- `POST /api/payments/notifications` - Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **Spring Boot 3.2.0** - –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL** - –û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Kafka** - –û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π
- **Flyway** - –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **Spring Data JPA** - –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **Spring WebFlux** - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API

## üîå –í–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Hackload Ticketing Service
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç–∞–º–∏
- API –≤–µ—Ä—Å–∏—è: v1

### Payment Gateway
- –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–æ—Ç–º–µ–Ω–∞
- HMAC-SHA256 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `events` - –°–æ–±—ã—Ç–∏—è
- `seats` - –ú–µ—Å—Ç–∞
- `bookings` - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `booking_seats` - –°–≤—è–∑—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∏ –º–µ—Å—Ç
- `payment_notifications` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–∞—Ö

### –ú–∏–≥—Ä–∞—Ü–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- Flyway –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏

## üê≥ Docker

```bash
# –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
docker-compose up -d

# –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker build -t biletter-service .

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker run -p 8081:8081 biletter-service
```

## üìä Kafka Topics

- `booking-events` - –°–æ–±—ã—Ç–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- `payment-events` - –°–æ–±—ã—Ç–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- `seat-selection-events` - –°–æ–±—ã—Ç–∏—è –≤—ã–±–æ—Ä–∞ –º–µ—Å—Ç

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `application.yml`:
- –ü–æ—Ä—Ç: 8081
- –ö–æ–Ω—Ç–µ–∫—Å—Ç: `/api`
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: PostgreSQL –Ω–∞ localhost:5432
- Kafka: localhost:9092

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ö–æ–º–ø–∏–ª—è—Ü–∏—è
mvn clean compile

# –°–±–æ—Ä–∫–∞ JAR
mvn clean package

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
mvn test

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
mvn spring-boot:run
```

## üìù –ü—Ä–∏–º–µ—Ä—ã API –∑–∞–ø—Ä–æ—Å–æ–≤

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
```bash
curl -X POST http://localhost:8081/api/events \
  -H "Content-Type: application/json" \
  -d '{"title": "–ö–æ–Ω—Ü–µ—Ä—Ç", "external": false}'
```

### –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
```bash
curl -X POST http://localhost:8081/api/bookings \
  -H "Content-Type: application/json" \
  -d '{"eventId": 1}'
```

### –í—ã–±–æ—Ä –º–µ—Å—Ç–∞
```bash
curl -X PATCH http://localhost:8081/api/seats/select \
  -H "Content-Type: application/json" \
  -d '{"bookingId": 1, "seatId": 1}'
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/main/java/com/metaload/biletter/
‚îú‚îÄ‚îÄ BiletterApplication.java          # –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ config/                           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ ExternalServiceConfig.java    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ KafkaConfig.java             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Kafka
‚îú‚îÄ‚îÄ controller/                       # REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ EventController.java         # API —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ BookingController.java       # API –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ SeatController.java          # API –º–µ—Å—Ç
‚îÇ   ‚îî‚îÄ‚îÄ PaymentController.java       # API –ø–ª–∞—Ç–µ–∂–µ–π
‚îú‚îÄ‚îÄ dto/                             # Data Transfer Objects
‚îÇ   ‚îú‚îÄ‚îÄ CreateEventRequest.java      # –ó–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ CreateBookingRequest.java    # –ó–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ ListSeatsResponseItem.java   # –û—Ç–≤–µ—Ç —Å–æ —Å–ø–∏—Å–∫–æ–º –º–µ—Å—Ç
‚îÇ   ‚îî‚îÄ‚îÄ ...                          # –î—Ä—É–≥–∏–µ DTO
‚îú‚îÄ‚îÄ model/                           # JPA —Å—É—â–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ Event.java                   # –°–æ–±—ã—Ç–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ Seat.java                    # –ú–µ—Å—Ç–æ
‚îÇ   ‚îú‚îÄ‚îÄ Booking.java                 # –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ BookingSeat.java             # –°–≤—è–∑—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–µ—Å—Ç–∞
‚îú‚îÄ‚îÄ repository/                      # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ EventRepository.java         # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ SeatRepository.java          # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –º–µ—Å—Ç
‚îÇ   ‚îú‚îÄ‚îÄ BookingRepository.java       # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ BookingSeatRepository.java   # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–≤—è–∑–µ–π
‚îî‚îÄ‚îÄ service/                         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
    ‚îú‚îÄ‚îÄ EventService.java            # –°–µ—Ä–≤–∏—Å —Å–æ–±—ã—Ç–∏–π
    ‚îú‚îÄ‚îÄ BookingService.java          # –°–µ—Ä–≤–∏—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
    ‚îú‚îÄ‚îÄ SeatService.java             # –°–µ—Ä–≤–∏—Å –º–µ—Å—Ç
    ‚îú‚îÄ‚îÄ PaymentService.java          # –°–µ—Ä–≤–∏—Å –ø–ª–∞—Ç–µ–∂–µ–π
    ‚îú‚îÄ‚îÄ HackloadService.java         # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Hackload
    ‚îî‚îÄ‚îÄ PaymentGatewayService.java   # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Payment Gateway
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `docker-compose up -d`
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å `mvn spring-boot:run`
3. API –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8081/api`

### –ü—Ä–æ–¥–∞–∫—à–Ω
1. –°–æ–±—Ä–∞—Ç—å JAR: `mvn clean package`
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å: `java -jar target/biletter-service-1.0.0.jar`
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω